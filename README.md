# Выполнено ДЗ № 1 (prepare+intro)

- Основное ДЗ
- Задание со *

## В процессе сделано:
1. Подготовка c веткой prepare, установка minikube, выяснение, почему восстанавливаются ресурсы в kube-system: coredns восстанавливается, т.к. он есть в deployment, ресурсы типа apiserver, etcd, scheduler - как понимаю за ними следит сама мастер-нода
2. Запуск web-сервера на nginx через web-pod.yaml на основе своего образа с DockerHub
3. Запуск микросервиса frontend из Hipster Shop. Изначально не стартует, т.к. в манифесте отсутствуют переменные в блоке env для контейнера, видимо они являются обязательными для корректной работы (все из примера манифеста на гитхабе или частично)

## Как запустить проект:
1. Тесты из обновленной методички для ветки prepare прошли успешно
2. Выполняется kubectl apply -f web-pod.yaml и затем проброс порта kubectl port-forward --address 0.0.0.0 pod/web 8000:8000
3. Выполняется kubectl apply -f frontend-pod-healthy.yaml

## Как проверить работоспособность:
1. - 
2. После проброса порта можно зайти по ссылке http://<ip>:8080/index.html
3. После применения обновленного манифества для frontend появляется под frontend в статусе Running


# Выполнено ДЗ № 2 (controllers)

- Основное ДЗ
- Задание со *

## В процессе сделано:
1. Создание frontend-replicaset.yaml. При изменении образа не происходит обновления подов, т.к. репликасет следит в первую очередь за количеством подов, если количество удовлетворяет условиям, то обновления не происходит, для обновления при внесении изменений нужно использовать деплоймент.
2. Созданы образы для paymentservice, paymentservice-replicaset.yaml и paymentservice-deployment.yaml, с деплоймент проверены обновление и откат
3. Созданы paymentservice-deployment-bg.yaml и paymentservice-deployment-reverse.yaml для реализации других стратегий развертывания.
4. Создан frontend-deployment.yaml с добавлением readinessProbe по примеру.
5. Создан node-exporter-daemonset.yaml для развертывания DaemonSet с NodeExporter, реализован запуск на всех нодах, включая мастер-ноды, через добавление tolerations.

## Как запустить проект:
1. Выполняется kubectl apply -f frontend-replicaset.yaml.
2. Выполняется kubectl apply -f paymentservice-deployment.yaml, при изменении тега образа с v0.0.1 на v0.0.2 и повторном запуске команды происходит обновление.
3.1. Выполняется kubectl apply -f paymentservice-deployment-bg.yaml, при изменении тега образа и повторном запуске команды происходит обновление по сценарию: сначала развертывание трех новых подов, потом удаление трех старых.
3.2. Выполняется kubectl apply -f paymentservice-deployment-reverse.yaml, при изменении тега образа и повторном запуске команды происходит обновление по сценарию: сначала удаление одного старого пода, потом запуск одного нового и т.д.
4. Выполняется kubectl apply -f frontend-deployment.yaml.
5. Выполняется kubectl apply -f node-exporter-daemonset.yaml.

## Как проверить работоспособность:
1. Запускаются 3 пода приложения frontend
2. Запускаются 3 пода приложения payment
3. Поды развертываются по заявленным выше сценариям
4. В описании подов после развертывания видно readinessProbe, при нарушении синтаксиса описания пробы и, например, попытке развертывания из образа с другим тегом, развертывание остановится на попытке запуска первого пода, которое не будет завершаться успешно. Проверить можно командой kubectl rollout status deployment/frontend, выполнить откат командой kubectl rollout undo deployment/frontend.
5. Выполнив запуск, можно увидеть, что запущено по одному поду на каждой ноде, при пробросе порта kubectl port-forward <имя любого pod в DaemonSet> 9100:9100 метрики будут в localhost:9100/metrics.

